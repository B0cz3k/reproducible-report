---
title: "Assignment 3: Reproducible report"
author: "Łukasz Borak, Jakub Jagła"
output: 
  html_document:
    theme: lumen
    css: "styles.css"
    toc: true
    toc_float: true
---

<div class="logo-container">
  <img src="logo.png" class="logo">
</div>

<div class="header">
  <p class="titles"> A3: Reproducible report </p>
  <p class="authors"> Jakub Jagła, Łukasz Borak </p>
  <hr>
</div>  

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(plotly)
library(tidyr)
library(stringr)
library(ggpubr)
library(dplyr)

require(gridExtra)

palette = c("#00618a","#0691c4","#00c4ff") #palette from PUT logo
```

```{r load-data,echo=FALSE}
data2018 <- read.csv("survey_results_2018.csv")
data2023 <- read.csv("survey_results_2023.csv")

colnames(data2023)[colnames(data2023) == "SOPartFreq"] <- "StackOverflowParticipate"
colnames(data2023)[colnames(data2023) == "SOVisitFreq"] <- "StackOverflowVisit"
colnames(data2023)[colnames(data2023) == "LanguageHaveWorkedWith"] <- "LanguageWorkedWith"


data2018$LanguageWorkedWith <- gsub("HTML;CSS", "HTML/CSS", data2018$LanguageWorkedWith)
data2023$LanguageWorkedWith <- gsub("Bash.Shell .all shells.", "Bash/Shell",data2023$LanguageWorkedWith)
data2023$DevType <- gsub("Senior Executive .C-Suite, VP, etc..", "C-Suite executive (CEO, CTO, etc.)", data2023$DevType)
dropna <- function(x) {
  return(x[!is.na(x)])
}
```

> [WIP] This document is a data visualization of exploratory data analysis of the "Stack Overflow developer surveys" conducted in 2018 and 2023. We compare the different trends and shifts in the way the developers seek help with their everyday tasks. 

## Developer profile {.tabset}

### Age

### Education

```{r education, echo=FALSE, warning=FALSE}
  data2018$FormalEducation <- gsub("I never completed any formal education", NA, data2018$FormalEducation)
  data2018$FormalEducation <- gsub("Some college/university study without earning a degree", NA, data2018$FormalEducation)
  data2018$FormalEducation <- gsub("Professional degree .JD, MD, etc..", "Professional degree (JD, MD, Ph.D, Ed.D, etc.)", data2018$FormalEducation)
  data2018$FormalEducation <- gsub("Other doctoral degree .Ph.D, Ed.D., etc..", "Professional degree (JD, MD, Ph.D, Ed.D, etc.)", data2018$FormalEducation)
  data2023$EdLevel <- gsub("Something else", NA, data2023$EdLevel)
  data2023$EdLevel <- gsub("Some college/university study without earning a degree", NA, data2023$EdLevel)
  
  data2018$FormalEducation <- gsub("Associate degree", "Associate degree (A.A., A.S., etc.)", data2018$FormalEducation)
  education_2018 <- data2018 %>%
    select(FormalEducation) %>%
    separate_rows(FormalEducation,sep=";") %>%
    group_by(FormalEducation) %>%
    summarise(count = n()) %>%
    mutate(perc = round(count*100/sum(count),2)) %>%
    drop_na()
  
  education_2018$Year <- "2018"
  
  education_2023 <- data2023 %>%
    select(EdLevel) %>%
    separate_rows(EdLevel,sep=";") %>%
    group_by(EdLevel) %>%
    summarise(count = n()) %>%
    mutate(perc = round(count*100/sum(count),2)) %>%
    drop_na()
  
  education_2023$Year <- "2023"
  colnames(education_2023)[colnames(education_2023) == "EdLevel"] <- "FormalEducation"
  
  education_both <- rbind(education_2018, education_2023)
  
  education_both$FormalEducation <- gsub("Bachelor’s degree .BA, BS, B.Eng., etc..", "Bachelor’s degree (B.A., B.S., B.Eng., etc.)", education_both$FormalEducation)
  education_both$FormalEducation <- gsub("Master’s degree .MA, MS, M.Eng., MBA, etc..", "Master’s degree (M.A., M.S., M.Eng., MBA, etc.)", education_both$FormalEducation)
  education_both$FormalEducation <- gsub("Secondary school .e.g. American high school, German Realschule or Gymnasium, etc..","Secondary school", education_both$FormalEducation)
  
order <- c("Primary/elementary school",
           "Secondary school",
           "Associate degree (A.A., A.S., etc.)",
           "Bachelor’s degree (B.A., B.S., B.Eng., etc.)",
           "Master’s degree (M.A., M.S., M.Eng., MBA, etc.)",
           "Professional degree (JD, MD, Ph.D, Ed.D, etc.)")

education_both <- education_both %>% mutate(FormalEducation = factor(FormalEducation, levels = order))

  plot_ly(education_both,
          x = ~FormalEducation,
          y = ~perc,
          type = 'bar',
          color = ~Year,
          frame = ~Year,
          colors = palette,
          animation_frame = ~Year) %>%
    layout(title = "Formal Education",
           xaxis = list(title = "Years of Experience"),
           yaxis = list(title = "Percentage of Respondents"),
           hovermode = "x",
           showlegend = FALSE)%>% 
    animation_button(visible=F) %>%
    animation_slider(yanchor="bottom",y=1,currentvalue = list(visible=F))
```

### Years coding

```{r years_coding, echo=FALSE, warning=FALSE}

order <- c("0-2 years", "3-5 years", "6-8 years", "9-11 years", "12-14 years", "15-17 years", "18-20 years", "21-23 years", "24-26 years", "27-29 years", "30 or more years")

coding_usual_2018 <- data2018 %>%
  select(YearsCoding) %>%
  group_by(YearsCoding) %>%
  summarise(count = n()) %>%
  mutate(perc = round(count*100/sum(count),2)) %>%
  drop_na()

coding_usual_2018$Status <- "Total coding"
coding_pro_2018 <- data2018 %>%
  select(YearsCodingProf) %>%
  group_by(YearsCodingProf) %>%
  summarise(count = n()) %>%
  mutate(perc = round(count*100/sum(count),2)) %>%
  drop_na()

coding_pro_2018$Status <- "Professional coding"
colnames(coding_pro_2018)[colnames(coding_pro_2018) == "YearsCodingProf"] <- "YearsCoding"

coding_both_2018 <- rbind(coding_usual_2018, coding_pro_2018)
coding_both_2018 <- coding_both_2018 %>% mutate(YearsCoding = factor(YearsCoding, levels = order))


plot_ly(coding_both_2018, x = ~YearsCoding, y = ~perc, type = 'bar', color = ~Status, frame = ~Status,
        colors = palette,
        animation_frame = ~Status) %>%
  layout(title = "Years of Coding Experience",
         xaxis = list(title = "Years of Experience"),
         yaxis = list(title = "Percentage of Respondents"),
         showlegend = FALSE) %>%
  animation_button(visible=F) %>%
  animation_slider(yanchor="bottom",y=1,currentvalue = list(visible=F))
```


### Employment status
```{r employment_status, echo=FALSE, warning=FALSE}
data2018$Employment <- gsub(",", "", data2018$Employment)
employment_2018 <- data2018 %>%
  select(Employment) %>%
  separate_rows(Employment,sep=";") %>%
  group_by(Employment) %>%
  summarise(count = n()) %>%
  mutate(perc = round(count*100/sum(count),2)) %>%
  drop_na()

employment_2018$Year <- "2018"

data2023$Employment <- gsub(",", "", data2023$Employment)
employment_2023 <- data2023 %>%
  select(Employment) %>%
  separate_rows(Employment,sep=";") %>%
  group_by(Employment) %>%
  filter(Employment %in% c("Employed full-time",
                           "Employed part-time",
                           "Independent contractor freelancer or self-employed",
                           "Not employed and not looking for work",
                           "Not employed but looking for work",
                           "Retired")) %>%
  summarise(count = n()) %>%
  mutate(perc = round(count*100/sum(count),2)) %>%
  drop_na()

employment_2023$Year <- "2023"

employment_both <- rbind(employment_2018, employment_2023)

plot_ly(employment_both,
        x = ~Employment,
        y = ~perc,
        type = 'bar',
        color = ~Year,
        frame = ~Year,
        colors = palette,
        animation_frame = ~Year) %>%
  layout(title = "Employment",
         xaxis = list(title = "Employment Status"),
         yaxis = list(title = "Percentage of Respondents"),
         hovermode = "x",
         showlegend = FALSE)%>% 
  animation_button(visible=F) %>%
  animation_slider(yanchor="bottom",y=1,currentvalue = list(visible=F))
```

## Stack Overflow visits frequency over time 

> [Add short description]
You can embed Shiny inputs and outputs in your document. Outputs are automatically updated whenever inputs change.  This demonstrates how a standard R plot can be made interactive by wrapping it in the Shiny `renderPlot` function. The `selectInput` and `sliderInput` functions create the input widgets used to drive the plot.

```{r SO_visit_freq, echo=FALSE, out.width="100%"}
x_order <- c("Multiple times per day", "Daily or almost daily", "A few times per week", "A few times per month or weekly", "Less than once per month or monthly")

grouped2018 <- group_by(data2018,StackOverflowVisit) %>%
  summarise(count = n()) %>% 
  mutate(freq = count/sum(count), Percentage = sprintf("%.2f%%",round(100*freq,2))) %>%
  drop_na()

grouped2018$Year <- "2018"

grouped2023 <- group_by(data2023,StackOverflowVisit) %>%
  summarise(count = n()) %>%
  mutate(freq = count/sum(count), Percentage = sprintf("%.2f%%",round(100*freq,2))) %>%
  drop_na()

grouped2023$Year <- "2023"

grouped_both <- rbind(grouped2018, grouped2023)

plot_visit_freq <- ggplot(grouped_both, aes(x=StackOverflowVisit, y=freq, fill=Year, text=paste(Percentage))) +
  geom_bar(stat="identity", position="dodge") +
  scale_x_discrete(limits = x_order) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Stack Overflow Visit Frequency Over Time",
       x = "Visit Frequency",
       y = "Proportion",
       fill = "Year") + 
  scale_fill_manual(values=palette)

ggplotly(plot_visit_freq,tooltip = c("text"))
```

## AI-Powered tools usage among developers in 2023

> Github Autopilot reigns supreme among AI-powered tools in 2023. The top 5 AI-powered tools used by developers in 2023 are shown below.

```{r ai-tools-usage,echo=FALSE,message=FALSE, warning=FALSE,out.width="100%"}
AI_currently_used <- data2023 %>%
  select(AIDevHaveWorkedWith) %>%
  separate_rows(AIDevHaveWorkedWith,sep=";") %>%
  group_by(AIDevHaveWorkedWith) %>%
  drop_na() %>%
  summarise(freq = n()/length(data2023$AIDevHaveWorkedWith)) %>% 
  arrange(desc(freq))

AI_currently_used$State <- "Currently using"
colnames(AI_currently_used)[colnames(AI_currently_used) == "AIDevHaveWorkedWith"] <- "Tech"

AI_want_to_use <- data2023 %>%
  select(AIDevWantToWorkWith) %>%
  separate_rows(AIDevWantToWorkWith,sep=";") %>%
  group_by(AIDevWantToWorkWith) %>%
  drop_na() %>%
  summarise(freq = n()/length(data2023$AIDevHaveWorkedWith)) %>% 
  arrange(desc(freq))

AI_want_to_use$State <- "Want to use"
colnames(AI_want_to_use)[colnames(AI_want_to_use) == "AIDevWantToWorkWith"] <- "Tech"

AI_both <- rbind(AI_currently_used,AI_want_to_use)

AI_both <- AI_both %>% mutate(perc = paste(round(100*freq,2),"%"))

AI_both <- AI_both %>% filter(Tech %in% head(AI_currently_used,5)$Tech)

plot_AI_use <- ggplot(AI_both, aes(x=reorder(Tech,-freq), y=freq, fill=State, text=paste(perc))) +
  geom_bar(stat="identity", position="dodge") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Top 5 AI-Powered Development Tools In 2023",
       x = "AI-Powered Tool",
       y = "Proportion of developers",
       fill = "State") + 
  scale_fill_manual(values=palette)

ggplotly(plot_AI_use,tooltip = c("text"))
```

## The most popular programming languages in 2018 and 2023

> The most popular programming languages among developers in 2018 and 2023 are shown below. The popularity of programming languages has shifted over time. 

```{r popular_languages, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%"}

languages_2018 <- data2018 %>%
  select(LanguageWorkedWith) %>%
  separate_rows(LanguageWorkedWith, sep = ";") %>%
  group_by(LanguageWorkedWith) %>%
  summarise(count = n()) %>%
  mutate(freq = count / length(dropna(data2018$LanguageWorkedWith))) %>%
  drop_na()%>% arrange(desc(freq)) %>% head(10)

languages_2023 <- data2023 %>%
  select(LanguageWorkedWith) %>%
  separate_rows(LanguageWorkedWith, sep = ";") %>%
  group_by(LanguageWorkedWith) %>%
  summarise(count = n()) %>%
  mutate(freq = count / length(dropna(data2023$LanguageWorkedWith))) %>%
  drop_na()%>% arrange(desc(freq)) %>% head(10)

plot2018 <- ggplot(languages_2018, aes(x=reorder(LanguageWorkedWith, -freq), y=freq)) +
  geom_bar(stat="identity", fill=palette[1]) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks = seq(0, 0.75, 0.25)) + 
  coord_cartesian(ylim = c(0, 0.75)) + 
  labs(title = "2018",
       x = "Language",
       y = "Proportion of developers using")

plot2023 <- ggplot(languages_2023, aes(x=reorder(LanguageWorkedWith, -freq), y=freq)) +
  geom_bar(stat="identity", fill=palette[2]) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks = seq(0, 0.75, 0.25)) + 
  coord_cartesian(ylim = c(0, 0.75)) + 
  labs(title = "2023",
       x = "Language",
       y = "") 

#combine both plots side by side
grid.arrange(
  plot2018, 
  plot2023, 
  ncol=2,
  top=text_grob(
    paste("Top 10 programming languages in 2018 and 2023"), 
    color="black", 
    face="bold", 
    size=18
    )
  )
```

## Wages comparison between 2018 and 2023 by developer positions. {.tabset}

> The wages of developers have increased over time. The wages of developers in 2018 and 2023 are compared below. 

### Year 2018 

```{r devtype_profits_2018,echo=FALSE,message=FALSE, warning=FALSE, out.width="100%"}
devtype_median_salary_2018 <- data2018 %>%
  select(DevType,ConvertedSalary) %>%
  separate_rows(DevType, sep = ";") %>%
  drop_na() %>%
  group_by(DevType) %>%
  summarise(median_salary = round(median(ConvertedSalary, na.rm = TRUE),2))%>% arrange(desc(median_salary)) %>% head(10)


plot_salary_2018 <- ggplot(devtype_median_salary_2018, 
                           aes(x=reorder(DevType, -median_salary), 
                               y=median_salary,
                               text=paste('Yearly Median: $',formatC(median_salary, big.mark=',', format = 'f')))) +
  geom_bar(stat="identity", fill=palette[1]) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(labels = scales::dollar) +
  labs(title = "",
       x = "Developer Type",
       y = "Median Salary")


ggplotly(plot_salary_2018,tooltip = c("text"))
```

### Year 2023

```{r devtype_profits_2023,echo=FALSE,message=FALSE, warning=FALSE, out.width="100%"}

devtype_median_salary_2023 <- data2023 %>%
  select(DevType,ConvertedCompYearly) %>%
  separate_rows(DevType, sep = ";") %>%
  drop_na() %>%
  group_by(DevType) %>%
  summarise(median_salary = round(median(ConvertedCompYearly, na.rm = TRUE),2))%>% arrange(desc(median_salary)) %>% head(10)

plot_salary_2023 <- ggplot(devtype_median_salary_2023, 
                           aes(x=reorder(DevType, -median_salary), 
                               y=median_salary,
                               text=paste('Yearly Median: $',formatC(median_salary, big.mark=',', format = 'f')))) +
  geom_bar(stat="identity", fill=palette[2]) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(labels = scales::dollar) +
  labs(title = "",
       x = "Developer Type",
       y = "Median Salary")

ggplotly(plot_salary_2023,tooltip = c("text"))
```


